<!doctype html>
<html>
<head>
<meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
<meta name="generator" content="TiddlyWiki" />
<meta name="tiddlywiki-version" content="5.1.13" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<meta name="apple-mobile-web-app-capable" content="yes" />
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
<meta name="mobile-web-app-capable" content="yes"/>
<meta name="format-detection" content="telephone=no">
<link id="faviconLink" rel="shortcut icon" href="favicon.ico">
<link rel="stylesheet" href="static.css">
<title>2018.10.07 - Computer Musings: Letsencrypt: ‚¶óh0p3's Wiki‚¶ò ‚Äî ‚Äç ‚Äç ‚Äç‚Äç ‚Äç1.2.20191101 ñ°∂ 

 Readme

</title>
</head>
<body class="tc-body">

<section class="tc-story-river">
<p><div class="tc-tiddler-frame tc-tiddler-view-frame tc-tiddler-exists   tc-tagged-Computer%20Musings " data-tags="[[Computer Musings]]" data-tiddler-title="2018.10.07 - Computer Musings: Letsencrypt"><div class="tc-tiddler-title">
<div class="tc-titlebar">
<span class="tc-tiddler-controls">
<span class=" tc-reveal"><button aria-label="more" class="tc-btn-invisible tc-btn-%24%3A%2Fcore%2Fui%2FButtons%2Fmore-tiddler-actions" title="More actions"></button><div class=" tc-reveal" hidden="true"></div></span><span class=" tc-reveal"><button aria-label="delete" class="tc-btn-invisible tc-btn-%24%3A%2Fcore%2Fui%2FButtons%2Fdelete" title="Delete this tiddler">


</button></span><span class=" tc-reveal"><button aria-label="permalink" class="tc-btn-invisible tc-btn-%24%3A%2Fcore%2Fui%2FButtons%2Fpermalink" title="Set browser address bar to a direct link to this tiddler"></button></span><span class=" tc-reveal"><span class=" tc-reveal"><button aria-label="info" class="tc-btn-invisible tc-btn-%24%3A%2Fcore%2Fui%2FButtons%2Finfo" title="Show information for this tiddler">
</button></span><span class=" tc-reveal" hidden="true"></span></span><span class=" tc-reveal"><span class=" tc-reveal" hidden="true"></span></span><span class=" tc-reveal"><button aria-label="new journal here" class="tc-btn-invisible tc-btn-%24%3A%2Fcore%2Fui%2FButtons%2Fnew-journal-here" title="Create a new journal tiddler tagged with this one">





</button></span><span class=" tc-reveal"><button aria-label="close others" class="tc-btn-invisible tc-btn-%24%3A%2Fcore%2Fui%2FButtons%2Fclose-others" title="Close other tiddlers"></button></span><span class=" tc-reveal"><button aria-label="edit" class="tc-btn-invisible tc-btn-%24%3A%2Fcore%2Fui%2FButtons%2Fedit" title="Edit this tiddler"></button></span><span class=" tc-reveal"><button aria-label="close" class="tc-btn-invisible tc-btn-%24%3A%2Fcore%2Fui%2FButtons%2Fclose" title="Close this tiddler"></button></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal" hidden="true"></span>
</span>

<a class="tc-tiddlylink tc-tiddlylink-resolves tc-popup-handle tc-popup-absolute" href="2018.10.07%2520-%2520Computer%2520Musings%253A%2520Letsencrypt.html">

<span class="tc-tiddler-title-icon" style="fill:;">

</span>



<h2 class="tc-title">
2018.10.07 - Computer Musings: Letsencrypt
</h2>

</a>

</div>

<div class="tc-tiddler-info tc-popup-handle tc-reveal" hidden="true"></div>
</div><div class=" tc-reveal" hidden="true"></div>
<div class=" tc-reveal">
<div class="tc-subtitle">
Edited: 2018.10.29 13:52
</div>
</div><div class=" tc-reveal">
<div class="tc-tags-wrapper"><span class="tc-tag-list-item">
<span class="tc-tag-label tc-btn-invisible" draggable="true" style="background-color:;
fill:#ffffff;
color:#ffffff;">
 Computer Musings
</span>
<span class="tc-drop-down tc-reveal" hidden="true"></span></span></div>
</div>

<div class="tc-tiddler-body tc-reveal"><p>This is almost comical. My ineptitude is loud and clear again. </p><p>Firefox was throwing up this error for me yesterday:</p><blockquote class="tc-quote"><p>Peer‚Äôs Certificate has expired. HTTP Strict Transport Security: false HTTP Public Key Pinning: false
</p></blockquote><p>Could be just on my end, but 99% sure it isn't.</p><p>I have no idea why I have so much trouble with letsencrypt; it's EZ mode, right? Every once'd in a while, something goes wrong with letsencrypt for me.</p><p>certbot tells me it's not expired. Thus, I'm clearly missing something. Let's just do it all over again (and then again, and so on), that will fix it, right? Fuck me.</p><pre class="bash hljs"><code>sudo certbot revoke --cert-path /etc/letsencrypt/archive/philosopher.life/cert1.pem
sudo certbot revoke --cert-path /etc/letsencrypt/live/philosopher.life/web.pem
sudo apt-get autoremove --purge certbot
sudo apt-get install certbot</code></pre><p>Can't pass letsencrypt test without temporarily killing the forced https lines in <code>/etc/lighttpd/lighttpd.conf</code></p><pre><code>$SERVER[&quot;socket&quot;] == &quot;:443&quot; {
ssl.engine = &quot;enable&quot;
ssl.pemfile = &quot;/etc/letsencrypt/live/philosopher.life/web.pem&quot; # Combined Certificate
ssl.ca-file = &quot;/etc/letsencrypt/live/philosopher.life/chain.pem&quot; # Root CA
server.name = &quot;philosopher.life&quot; # Domain Name OR Virtual Host Name
server.document-root = &quot;/var/www/html&quot; # Document Root
server.errorlog = &quot;/var/log/lighttpd/error.log&quot;
}

$HTTP[&quot;scheme&quot;] == &quot;http&quot; {
$HTTP[&quot;host&quot;] == &quot;philosopher.life&quot; { # HTTP URL
url.redirect = (&quot;/.*&quot; =&gt; &quot;https://philosopher.life$0&quot;) # Redirection HTTPS URL
}
}</code></pre><pre class="bash hljs"><code>sudo certbot certonly --webroot -w /var/www/html <span class="hljs-operator">-d</span> philosopher.life <span class="hljs-operator">-d</span> www.philosopher.life
sudo cat /etc/letsencrypt/live/philosopher.life/cert.pem /etc/letsencrypt/live/philosopher.life/privkey.pem &gt; /etc/letsencrypt/live/philosopher.life/web.pem</code></pre><p>Restore lighttpd.conf lines</p><pre class="bash hljs"><code>sudo service lighttpd restart
sudo certbot renew --dry-run
sudo crontab <span class="hljs-operator">-e</span></code></pre><p><code>6 1,13 * * * certbot renew --renew-hook &quot;service lighttpd restart&quot;</code></p><p>I'm missing something stupid obvious to someone who isn't a skiddie here. I predict a failure on 2019-01-05. For the giggles, I may just run this next time:</p><pre><code>sudo cat /etc/letsencrypt/live/philosopher.life/cert.pem /etc/letsencrypt/live/philosopher.life/privkey.pem &gt; /etc/letsencrypt/live/philosopher.life/web.pem</code></pre><p>I could just write the script to completely rekey every 3 months. Ah, my insanity. The Rube Goldberg Computing life. </p><p>Also, I should consider moving away from lighttpd. 
</p></div>



</div>

</p>
</section>
</body>
</html>
